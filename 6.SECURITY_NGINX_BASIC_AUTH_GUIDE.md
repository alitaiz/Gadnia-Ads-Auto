# Hướng Dẫn (Bảo mật): Cài đặt Mật khẩu cho Website bằng Nginx Basic Authentication

## Giới thiệu

Đây là phương pháp được khuyến nghị để bảo vệ ứng dụng của bạn một cách nhanh chóng và hiệu quả. Chúng ta sẽ sử dụng tính năng "Basic Authentication" của web server Nginx để yêu cầu tên đăng nhập và mật khẩu trước khi bất kỳ ai có thể xem nội dung trang web.

**Quan trọng:** Hướng dẫn này nên được thực hiện **SAU KHI** bạn đã kích hoạt HTTPS bằng Certbot (xem Hướng dẫn 5).

**Ưu điểm:**
-   **An toàn cao:** Mật khẩu được kiểm tra ở cấp độ web server, trước khi yêu cầu được chuyển đến ứng dụng Node.js.
-   **Triển khai nhanh:** Chỉ mất vài phút để cấu hình.
-   **Bảo vệ toàn diện:** Cả frontend và backend API đều được bảo vệ.
-   **Không cần sửa code:** Toàn bộ cấu hình nằm trong Nginx.

---

## Các bước Thực hiện

### Bước 1: Cài đặt Công cụ tạo Mật khẩu

Chúng ta cần một công cụ gọi là `htpasswd` để tạo file mật khẩu đã được mã hóa. Công cụ này nằm trong gói `apache2-utils`.

1.  Kết nối vào VPS của bạn qua SSH.
2.  Chạy lệnh sau để cài đặt:
    ```bash
    sudo apt update
    sudo apt install apache2-utils -y
    ```

### Bước 2: Tạo File Mật khẩu

Lệnh này sẽ tạo một file mới tên là `.htpasswd` trong thư mục `/etc/nginx/`, chứa tên người dùng và mật khẩu đã được mã hóa.

1.  Chạy lệnh sau. Hãy thay `your_admin_user` bằng tên đăng nhập bạn muốn.
    ```bash
    sudo htpasswd -c /etc/nginx/.htpasswd your_admin_user
    ```
    -   **Lưu ý:** Tùy chọn `-c` (create) chỉ được dùng cho **lần đầu tiên** để tạo file. Nếu sau này bạn muốn thêm một người dùng khác, hãy bỏ tùy chọn `-c` đi.

2.  Bạn sẽ được nhắc nhập và xác nhận mật khẩu mới. Hãy nhập một mật khẩu đủ mạnh và ghi nhớ nó.

### Bước 3: Cập nhật Cấu hình Nginx (Bước Quan Trọng Nhất)

Đây là bước dễ xảy ra lỗi nhất. Để đảm bảo cấu hình của bạn chính xác, chúng tôi đã tạo một file mẫu hoàn chỉnh. Bạn sẽ thay thế toàn bộ nội dung file cấu hình hiện tại của mình bằng file mẫu này.

1.  **Mở file cấu hình Nginx của trang web bạn:**
    ```bash
    sudo nano /etc/nginx/sites-available/gadnia.tababyco.com
    ```
2.  **Xóa toàn bộ nội dung cũ** bên trong file (`Ctrl + K` nhiều lần trong nano).

3.  **Sao chép và dán toàn bộ nội dung** từ file mẫu `document/nginx.conf.example.txt` vào.

4.  **Thực hiện các thay đổi cần thiết** trong file bạn vừa dán:
    -   Tìm và thay thế tất cả các chuỗi `gadnia.tababyco.com` bằng **tên miền chính xác của bạn**.
    -   Tìm dòng `root /var/www/Gadnia-Ads-Auto/dist;` và đảm bảo đường dẫn này **trỏ đến đúng thư mục `dist`** của dự án frontend của bạn.

5.  Lưu file và thoát trình soạn thảo (nhấn `Ctrl + X`, sau đó `Y`, và `Enter`).

### Bước 4: Kiểm tra và Khởi động lại Nginx

1.  Luôn kiểm tra cú pháp file cấu hình trước khi khởi động lại. Lệnh này sẽ báo cho bạn biết nếu có lỗi cú pháp.
    ```bash
    sudo nginx -t
    ```
    -   Nếu bạn thấy thông báo `syntax is ok` và `test is successful`, mọi thứ đã sẵn sàng. Nếu có lỗi, hãy kiểm tra lại file cấu hình.

2.  Áp dụng các thay đổi bằng cách khởi động lại Nginx:
    ```bash
    sudo systemctl restart nginx
    ```

---

## Xử lý sự cố (Troubleshooting)

**Vấn đề: Tôi vẫn vào được trang web mà không cần mật khẩu!**

Đây là các nguyên nhân phổ biến nhất:

1.  **Trình duyệt đang lưu cache:** Trình duyệt có thể đã lưu lại phiên bản trang web từ trước khi bạn bật mật khẩu.
    -   **Giải pháp:** Mở một **cửa sổ ẩn danh (Incognito/Private Window)** và truy cập lại trang web. Đây là cách chắc chắn nhất để kiểm tra. Bạn cũng có thể thử xóa cache và cookie của trình duyệt.
2.  **Nginx chưa được khởi động lại:** Các thay đổi trong file cấu hình chỉ có hiệu lực sau khi Nginx được khởi động lại.
    -   **Giải pháp:** Chạy lại lệnh `sudo systemctl restart nginx`.
3.  **Chỉnh sửa sai file:** Bạn có thể đã chỉnh sửa file `/etc/nginx/sites-available/default` thay vì file của trang web của bạn (`gadnia.tababyco.com`).
    -   **Giải pháp:** Kiểm tra lại xem bạn đã chỉnh sửa đúng file chưa.
4.  **Lỗi cú pháp trong Nginx:** Nếu có lỗi cú pháp, Nginx sẽ không thể tải cấu hình mới và sẽ tiếp tục chạy với cấu hình cũ.
    -   **Giải pháp:** Chạy `sudo nginx -t`. Nếu có lỗi, nó sẽ chỉ ra dòng và file gây ra lỗi để bạn sửa.

## Hoàn tất!

Bây giờ, hãy thử truy cập vào trang web `https://gadnia.tababyco.com` của bạn trong một cửa sổ ẩn danh. Trình duyệt sẽ hiện lên một hộp thoại yêu cầu bạn nhập tên người dùng và mật khẩu đã tạo ở Bước 2.

-   **Người dùng (bạn):** Sẽ phải đăng nhập để xem giao diện.
-   **AWS Lambda:** Sẽ gửi dữ liệu đến `/api/stream-ingest` một cách trơn tru mà không bị hỏi mật khẩu.